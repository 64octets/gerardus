//ImageTypes
(FixedInternalImagePixelType "float")
(FixedImageDimension 2)
(MovingInternalImagePixelType "float")
(MovingImageDimension 2)

//Components
(Registration "MultiMetricMultiResolutionRegistration")
(FixedImagePyramid "FixedSmoothingImagePyramid" "FixedSmoothingImagePyramid" "FixedSmoothingImagePyramid")
(MovingImagePyramid "MovingSmoothingImagePyramid" "MovingSmoothingImagePyramid" "MovingSmoothingImagePyramid")
(Interpolator "LinearInterpolator" "LinearInterpolator" "LinearInterpolator")
(Metric "AdvancedMeanSquares" "AdvancedMeanSquares" "AdvancedMeanSquares")
(Optimizer "RegularStepGradientDescent")
(ResampleInterpolator "FinalLinearInterpolator")
(Resampler "DefaultResampler" "DefaultResampler" "DefaultResampler")
(Transform "EulerTransform")
(UseDirectionCosines "true")
(UseCyclicTransform "false")

// Initial alignment of the images
(AutomaticTransformInitialization "false")
(AutomaticTransformInitializationMethod "GeometricalCenter")

// Let elastix compute the automatic scaling of rotations and translations
//(AutomaticScalesEstimation "true")
(Scales 0.6 0.01 0.01)

// Erosion of the mask prevents the border / edge of the mask taken
// into account. This can be useful for example for ultrasound images,
// where you don't want to take into account values outside the US-beam,
// but where you also don't want to match the edge / border of this
// beam. For example for MRI's of the head, the borders of the head may
// be wanted to match, and there erosion should be avoided.  
(ErodeMask "false")

// Number of levels in the multi-resolution pyramid strategy
(NumberOfResolutions 3)
(ImagePyramidSchedule 16 16 4 4 1 1)

(HowToCombineTransforms "Compose")

// Small histology slices will give the error "Too many samples map
// outside moving image buffer"
(RequiredRatioOfValidSamples 0.05)

//Maximum step size of the RSGD optimizer for each resolution level.
// The higher you set this, the more aggressive steps are taken.
(MaximumStepLength 1.0 1.0 1.0)

//Minimum step size of the RSGD optimizer for each resolution level.
// The lower you set this, the more accurate the final result.
(MinimumStepLength 0.01)

//Minimum magnitude of the gradient (stopping criterion) for the RSGD optimizer:
// The lower you set this, the more accurate the final result may be.
(MinimumGradientMagnitude 0.01)

// Number of grey level bins in each resolution level:
(NumberOfHistogramBins 64)
(FixedLimitRangeRatio 0.0)
(MovingLimitRangeRatio 0.0)

// Number of spatial samples used to compute the mutual information in
// each resolution level:

// "RandomCoordinate" works well with the StandardGradientDescent and
// AdaptiveStochasticGradientDescent optimisers,
//(ImageSampler "RandomCoordinate" "RandomCoordinate" "RandomCoordinate")
//(NewSamplesEveryIteration "true")
//(NumberOfSpatialSamples 0 0 0)
//(MaximumNumberOfSamplingAttempts 10)
(ImageSampler "Full" "Full" "Full")
(FixedImageBSplineInterpolationOrder 1)
(UseRandomSampleRegion "false")

(UseFastAndLowMemoryVersion "true")
(UseJacobianPreconditioning "false")
(FiniteDifferenceDerivative "false")

// Default pixel value for pixels that come from outside the picture:
(DefaultPixelValue 0)

// Output
(WriteResultImage "true")
(WriteResultImageAfterEachResolution "false")
(WriteTransformParametersEachIteration "false")
(WriteTransformParametersEachResolution "true")
(ResultImagePixelType "unsigned char")
(ResultImageFormat "png")
(CompressResultImage "true")
